<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§§ é‡‘è›‡è¿æ˜¥ï¼šéˆä¸Šæ“²ç­Šåšé»ƒé‡‘ ğŸ§§</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js" type="application/javascript"></script>

    <style>
        /* --- åŸºç¤è¨­å®š --- */
        body {
            background-color: #500000;
            background-image: linear-gradient(135deg, #800000 25%, #500000 100%);
            color: #FFD700;
            font-family: 'Microsoft JhengHei', sans-serif;
            text-align: center;
            padding: 20px;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
            perspective: 1000px; /* å…¨å±€è¦–è§’ */
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.7);
            padding: 25px;
            border-radius: 20px;
            border: 2px solid #FFD700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
            position: relative;
        }
        h1 { margin-bottom: 5px; text-shadow: 2px 2px 4px #000; }

        /* --- å„€è¡¨æ¿ & æ•¸æ“šæ¢ --- */
        .dashboard {
            background: linear-gradient(to bottom, #330000, #1a0000);
            border: 1px solid #FFA500; border-radius: 10px; padding: 15px; margin-bottom: 15px;
            display: flex; flex-direction: column; gap: 10px;
        }
        .dashboard-row {
            display: flex; justify-content: space-between; align-items: center; font-size: 15px;
            border-bottom: 1px dashed #555; padding-bottom: 8px;
        }
        .dashboard-row:last-child { border-bottom: none; padding-bottom: 0; }
        .highlight-val { color: #00FF00; font-weight: bold; font-family: monospace; font-size: 16px; }
        .my-stats {
            display: flex; justify-content: space-around; background: #400000; padding: 10px;
            border-radius: 10px; margin-bottom: 20px; font-size: 14px; border: 1px solid #800000;
        }

        /* --- æŒ‰éˆ•èˆ‡è¼¸å…¥ --- */
        .action-bar { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; }
        .small-btn {
            background: rgba(255, 215, 0, 0.1); border: 1px solid #FFD700; color: #FFD700;
            padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 14px; transition: all 0.2s;
        }
        .small-btn:hover { background: rgba(255, 215, 0, 0.3); scale: 1.05; }
        .btn {
            background: linear-gradient(180deg, #FFD700, #FFA500); border: 1px solid #fff;
            padding: 15px 40px; font-size: 20px; font-weight: bold; color: #800000;
            cursor: pointer; border-radius: 50px; margin: 15px 0; transition: all 0.2s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); width: 80%;
        }
        .btn:active { transform: scale(0.95); }
        .btn:disabled { background: #555; color: #888; cursor: not-allowed; border-color: #555; }
        .input-group { margin: 20px 0 10px 0; }
        input {
            padding: 12px; font-size: 20px; border-radius: 8px; border: 2px solid #FFD700;
            background: #200000; color: #fff; text-align: center; width: 180px; font-weight: bold;
        }
        .max-bet-hint { font-size: 13px; color: #FFA500; margin-top: 5px; }
        
        /* --- ğŸ†• æ“¬çœŸç­Šæ¯å‹•ç•«å€ --- */
        .jiaobei-wrapper {
            height: 150px; display: flex; justify-content: center; align-items: center;
            gap: 50px; perspective: 800px; margin: 20px 0; position: relative;
        }
        /* ç­Šæ¯æœ¬é«” */
        .jiaobei {
            width: 80px; height: 40px; background: #d63031; border-radius: 0 0 40px 40px;
            position: relative; transform-style: preserve-3d;
            box-shadow: inset 0 -5px 10px rgba(0,0,0,0.3);
            transition: transform 0.5s ease-out; /* å®šæ ¼æ™‚çš„å¹³æ»‘éæ¸¡ */
        }
        /* å¹³é¢ (Yang) */
        .jiaobei::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #ff7675; border-radius: 0 0 40px 40px;
            transform: rotateX(180deg) translateZ(1px); /* å¾®èª¿Zè»¸é¿å…é–ƒçˆ */
            backface-visibility: hidden;
        }
        /* å‡¸é¢ (Yin) */
        .jiaobei::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            border-radius: 0 0 40px 40px;
            background: radial-gradient(circle at 30% 30%, #ff5252, #b71540);
            transform: translateZ(-1px);
            backface-visibility: hidden;
        }

        /* ğŸ†• æ–°ç‰ˆæ‹‹æ“²å‹•ç•«ï¼šå‘ä¸Šé£›èµ·ä¸¦ç˜‹ç‹‚ç¿»æ»¾ */
        @keyframes tumble-up {
            0% { transform: translateY(0) rotateX(0) rotateY(0) rotateZ(0) scale(1); }
            20% { transform: translateY(-80px) rotateX(360deg) rotateY(180deg) rotateZ(45deg) scale(1.1); } /* é£›åˆ°æœ€é«˜é» */
            40% { transform: translateY(-100px) rotateX(720deg) rotateY(360deg) rotateZ(90deg) scale(1.1); }
            60% { transform: translateY(-60px) rotateX(1080deg) rotateY(540deg) rotateZ(180deg) scale(1.05); } /* é–‹å§‹è½ä¸‹ */
            80% { transform: translateY(-20px) rotateX(1440deg) rotateY(720deg) rotateZ(270deg) scale(1.02); }
            100% { transform: translateY(0) rotateX(1800deg) rotateY(900deg) rotateZ(360deg) scale(1); } /* å›åˆ°åœ°é¢ */
        }
        /* å½±å­å‹•ç•«ï¼Œå¢åŠ ç«‹é«”æ„Ÿ */
        @keyframes shadow-scale {
            0%, 100% { opacity: 0.8; transform: scale(1); }
            20%, 40% { opacity: 0.3; transform: scale(0.6); } /* é£›é«˜æ™‚å½±å­è®Šå°è®Šæ·¡ */
        }

        .tossing { animation: tumble-up 0.8s infinite linear; }
        
        /* é™°å½±å±¤ */
        .shadow-layer {
            position: absolute; bottom: 10px; width: 80px; height: 20px;
            background: rgba(0,0,0,0.5); border-radius: 50%; filter: blur(5px);
            z-index: -1;
        }
        .tossing-shadow { animation: shadow-scale 0.8s infinite linear; }

        /* çµæœå®šæ ¼ç‹€æ…‹ */
        .state-yin { transform: rotateX(0deg); } 
        .state-yang { transform: rotateX(180deg); } 
        .state-li { transform: rotateX(-90deg) rotateY(0deg) rotateZ(90deg); box-shadow: 0 0 25px #FF00FF; }

        /* --- çµæœæ–‡å­—å€ --- */
        .result-area {
            min-height: 80px; background: rgba(255, 255, 255, 0.05); border-radius: 15px;
            padding: 15px; font-size: 20px; font-weight: bold; margin-top: 20px;
        }
        .hash-box {
            background-color: #000; color: #00FF00; font-family: 'Courier New', monospace;
            padding: 8px; margin: 10px 0; border-radius: 5px; font-size: 11px;
            word-break: break-all; min-height: 20px; border: 1px solid #333;
        }
        .gold-text {
            color: #fff; font-size: 15px; margin-top: 8px;
            background: rgba(218, 165, 32, 0.4); padding: 5px 12px; border-radius: 20px;
        }

        /* --- Modal å½ˆçª— --- */
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); backdrop-filter: blur(5px); }
        .modal-content { background: #300000; border: 2px solid #FFD700; margin: 10% auto; padding: 25px; width: 85%; max-width: 450px; border-radius: 15px; position: relative; box-shadow: 0 0 30px #FFD700; text-align: left;}
        .close-btn { color: #aaa; float: right; font-size: 32px; cursor: pointer; line-height: 32px;}
        .close-btn:hover { color: #fff; }
        .modal-h2 { text-align: center; border-bottom: 2px solid #FFD700; padding-bottom: 15px; margin-top: 0; color: #FFD700; font-size: 24px;}
        
        /* è¦å‰‡æ¨£å¼ */
        .rule-group { margin-bottom: 20px; }
        .rule-title { color: #FFD700; font-weight: bold; margin-bottom: 8px; font-size: 18px; border-left: 4px solid #FFD700; padding-left: 10px;}
        .rule-item { font-size: 16px; line-height: 1.8; margin-left: 15px; color: #eee;}

        /* ğŸ†• æ’è¡Œæ¦œæ¨£å¼ (æ®¿å ‚æ„Ÿ) */
        .leader-section {
            background: rgba(0,0,0,0.4); padding: 20px; border-radius: 15px;
            border: 1px solid #FFD700; text-align: center; margin-bottom: 20px;
            box-shadow: inset 0 0 20px rgba(255,215,0,0.2);
        }
        .leader-badge { font-size: 40px; margin-bottom: 10px; }
        .leader-label { color: #aaa; font-size: 14px; margin-bottom: 5px; }
        .leader-addr { color: #00FFFF; font-family: monospace; font-size: 20px; word-break: break-all; font-weight: bold; text-shadow: 0 0 10px #00FFFF;}
        .leader-val { font-size: 36px; color: #FFD700; font-weight: bold; text-shadow: 0 0 15px #FFD700;}
        .my-rank-section {
            border-top: 1px dashed #555; padding-top: 20px; text-align: center; color: #ccc;
        }

        @keyframes flash { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.6; transform: scale(1.05); } 100% { opacity: 1; transform: scale(1); } }
        .critical { color: #FF00FF; text-shadow: 0 0 15px #FF00FF; animation: flash 0.4s infinite; font-size: 26px; }
        .sheng-jiao { color: #FFD700; text-shadow: 0 0 10px #FFD700; }
        .xiao-jiao { color: #FFA500; }
        .yin-jiao { color: #aaa; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ¯ è™çˆºè³œç¦æ“²ç­Šå° ğŸ¯</h1>
    <p style="color:#ccc; font-size:14px;">é€£çµéŒ¢åŒ… -> è¼¸å…¥é‡‘é¡ -> æ“²å‡ºè–ç­Šæ‹¿é»ƒé‡‘ï¼</p>
    
    <div class="dashboard">
        <div class="dashboard-row">
            <span>ğŸ’ é€£å‹ç´¯ç©çæ± :</span>
            <span><span class="highlight-val" id="streakPool">0.0000</span> BNB</span>
        </div>
    </div>

    <div class="my-stats">
        <div>ğŸ’° é¤˜é¡: <span id="userBalance" style="color:#fff">---</span></div>
        <div>ğŸ² é€£å‹: <span id="userStreak" style="color:#fff">0</span></div>
    </div>

    <div class="action-bar">
        <button class="small-btn" onclick="openLeaderboard()">ğŸ† é€£å‹æ®¿å ‚æ’è¡Œæ¦œ</button>
        <button class="small-btn" onclick="openRules()">ğŸ“œ éŠæˆ²è¦å‰‡èªªæ˜</button>
    </div>

    <button id="connectBtn" class="btn" onclick="connectWallet()">ğŸ¦Š é€£çµéŒ¢åŒ… (Connect)</button>
    
    <div id="gameArea" style="display:none;">
        
        <div class="jiaobei-wrapper">
            <div style="position: relative;">
                <div id="blockA" class="jiaobei state-yin"></div>
                <div id="shadowA" class="shadow-layer"></div>
            </div>
            <div style="position: relative;">
                <div id="blockB" class="jiaobei state-yang"></div>
                <div id="shadowB" class="shadow-layer"></div>
            </div>
        </div>

        <div class="input-group">
            <label>ä¸‹æ³¨é‡‘é¡ (BNB)</label><br>
            <input type="number" id="betAmount" value="0.001" step="0.001" min="0.001">
            <div class="max-bet-hint" id="maxBetDisplay">æ­£åœ¨è¨ˆç®—æœ€å¤§é™é¡...</div>
        </div>

        <button id="playBtn" class="btn" onclick="playGame()">ğŸ™ èª å¿ƒæ“²ç­Š (Play)</button>

        <div class="hash-box" id="hashDisplay">
            [ è«‹å…ˆæ“²ç­Šï¼Œç­‰å¾…å€å¡Šéˆç”Ÿæˆéš¨æ©Ÿç¢¼... ]
        </div>

        <div class="result-area" id="resultDisplay">
            æº–å‚™å¥½äº†å—ï¼Ÿ<br>è™çˆºçœ‹è‘—ä½ å‘¢...
        </div>
    </div>
</div>

<div id="leaderModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('leaderModal')">&times;</span>
        <h2 class="modal-h2">ğŸ† é€£å‹æ®¿å ‚ ğŸ†</h2>
        
        <div class="leader-section">
            <div class="leader-badge">ğŸ‘‘</div>
            <div class="leader-label">ç•¶å‰å…¨ç¶²é€£å‹éœ¸ä¸»</div>
            <span class="leader-addr" id="modalWinnerAddr">---</span>
            <div style="margin-top: 15px;">
                <div class="leader-label">æœ€é«˜é€£å‹ç´€éŒ„</div>
                <span class="leader-val" id="modalHighestStreak">0</span>
                <span style="color:#FFD700">æ¬¡</span>
            </div>
            <div style="font-size:12px; color:#FFD700; margin-top:10px;">* éœ¸ä¸»å°‡æ–¼é€±çµç®—æ™‚ç¨å¾— 80% çæ±  *</div>
        </div>

        <div class="my-rank-section">
            <div style="font-size: 18px; color:#fff; margin-bottom: 10px;">ğŸ‘¤ æˆ‘çš„ç´€éŒ„</div>
            <div>ç›®å‰é€£å‹: <span id="modalMyStreak" style="color:#00FF00; font-weight:bold; font-size:20px;">0</span> æ¬¡</div>
            <div style="font-size: 13px; margin-top:5px;">(ç¹¼çºŒæŒ‘æˆ°ï¼Œçˆ­å¥ªéœ¸ä¸»å¯¶åº§ï¼)</div>
        </div>
    </div>
</div>

<div id="rulesModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('rulesModal')">&times;</span>
        <h2 class="modal-h2">ğŸ“œ éŠæˆ²è¦å‰‡</h2>
        
        <div class="rule-group">
            <div class="rule-title">ğŸ’ ç²å‹èˆ‡è³ ç‡</div>
            <div class="rule-item">âš¡ <strong>ç«‹ç­Š (æš´æ“Š)</strong>ï¼šç²åˆ© <span style="color:#FF00FF; font-size:20px;">8 å€</span></div>
            <div class="rule-item">ğŸ™ <strong>è–ç­Š (ç²å‹)</strong>ï¼šç²åˆ© <span style="color:#FFD700; font-size:20px;">2 å€</span></div>
            <div class="rule-item">ğŸ˜Š <strong>ç¬‘ç­Š (å¹³å±€)</strong>ï¼šé€€é‚„ä¸€åŠæœ¬é‡‘</div>
            <div class="rule-item">ğŸŒ‘ <strong>é™°ç­Š (æœªä¸­)</strong>ï¼šä¸‹æ¬¡å¥½é‹</div>
        </div>
        
        <div class="rule-group">
            <div class="rule-title">ğŸ”¥ é€£å‹æ©Ÿåˆ¶</div>
            <div class="rule-item">æ“²å‡ºã€Œè–ç­Šã€æˆ–ã€Œç«‹ç­Šã€ç´¯ç©é€£å‹ã€‚</div>
            <div class="rule-item">æ“²å‡ºã€Œç¬‘ç­Šã€æˆ–ã€Œé™°ç­Šã€é€£å‹æ­¸é›¶ã€‚</div>
        </div>

        <div class="rule-group">
            <div class="rule-title">ğŸ’° è³‡é‡‘åˆ†é…</div>
            <div class="rule-item">75% æ“²ç­Šçæ±  (å³æ™‚è³ ä»˜)</div>
            <div class="rule-item">10% é€£å‹çæ±  (é€±å† è»ç¨å¾—)</div>
            <div class="rule-item">10% ä¾›å¥‰å¹´ç¸ (ç´¯ç©å¤§çæ´»å‹•)</div>
            <div class="rule-item">5% æ¨è–¦äººçå‹µ</div>
        </div>
    </div>
</div>

<script>
    const CONTRACT_ADDRESS = "0x7A427604Ff8Ce728A60cF5cB247B30C0cE29188B"; 
    const BNB_PRICE_USD = 620; 
    const GOLD_PRICE_USD_PER_GRAM = 85; 

    const ABI = [
        "function play(address referrer) external payable",
        "function userStreaks(address) view returns (uint256, uint256, uint256, uint256)",
        "function streakPoolBalance() view returns (uint256)",
        "function currentWeeklyWinner() view returns (address)",
        "function highestStreak() view returns (uint256)",
        "event GameResult(address indexed player, string resultType, uint256 payout, uint256 rawRandom, uint256 betAmount, bytes32 gameHash)"
    ];

    let provider, signer, contract;
    let currentMaxBet = 0; 
    let cachedWinner = "---";
    let cachedHighest = 0;
    let myCurrentStreak = 0; // æš«å­˜æˆ‘çš„é€£å‹

    async function connectWallet() {
        if (typeof ethers === 'undefined') { alert("Ethers.js è¼‰å…¥å¤±æ•—"); return; }
        if (!window.ethereum) { alert("è«‹å®‰è£ MetaMask!"); return; }
        try {
            provider = new ethers.providers.Web3Provider(window.ethereum);
            await provider.send("eth_requestAccounts", []); 
            signer = provider.getSigner();
            const address = await signer.getAddress();
            
            document.getElementById("connectBtn").innerText = "âœ… å·²é€£çµ";
            document.getElementById("connectBtn").disabled = true; 
            document.getElementById("gameArea").style.display = "block";

            contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
            await updateAllStats(address);
            contract.on("GameResult", () => { updateAllStats(address); });
        } catch (error) { console.error(error); alert("é€£çµå¤±æ•—: " + error.message); }
    }

    async function updateAllStats(userAddress) {
        try {
            const balance = await provider.getBalance(userAddress);
            document.getElementById("userBalance").innerText = parseFloat(ethers.utils.formatEther(balance)).toFixed(4);
            
            const uStreak = await contract.userStreaks(userAddress);
            myCurrentStreak = uStreak[0].toString(); // æ›´æ–°æˆ‘çš„é€£å‹
            document.getElementById("userStreak").innerText = myCurrentStreak;
            
            const sPool = await contract.streakPoolBalance();
            cachedHighest = await contract.highestStreak();
            const winner = await contract.currentWeeklyWinner();
            document.getElementById("streakPool").innerText = parseFloat(ethers.utils.formatEther(sPool)).toFixed(4);
            cachedWinner = (winner === "0x0000000000000000000000000000000000000000") ? "å°šç„¡ (è™›ä½ä»¥å¾…)" : winner;
            
            const contractBalance = await provider.getBalance(CONTRACT_ADDRESS);
            const availablePool = contractBalance.sub(sPool);
            const maxBetBNB = availablePool.div(10);
            currentMaxBet = parseFloat(ethers.utils.formatEther(maxBetBNB));
            const hintEl = document.getElementById("maxBetDisplay");
            if (currentMaxBet <= 0.001) {
                hintEl.innerHTML = `âš ï¸ æ± åº•ä¹¾æ¯ï¼Œåƒ…é™ä¸‹æ³¨ <span style='color:#fff'>0.001</span> BNB`;
                hintEl.style.color = "#FF4444";
            } else {
                hintEl.innerHTML = `âš ï¸ ç•¶å‰å–®ç­†ä¸Šé™: <span style='color:#00FF00'>${currentMaxBet.toFixed(4)}</span> BNB`;
                hintEl.style.color = "#FFA500";
            }
        } catch (e) { console.error(e); }
    }

    // --- å‹•ç•«æ§åˆ¶ (å„ªåŒ–ç‰ˆ) ---
    function setBlocksState(state) {
        const bA = document.getElementById("blockA");
        const bB = document.getElementById("blockB");
        const sA = document.getElementById("shadowA");
        const sB = document.getElementById("shadowB");
        
        const classes = ["state-yin", "state-yang", "state-li", "tossing"];
        bA.classList.remove(...classes); bB.classList.remove(...classes);
        sA.classList.remove("tossing-shadow"); sB.classList.remove("tossing-shadow");

        if (state === "tossing") {
            bA.classList.add("tossing"); bB.classList.add("tossing");
            sA.classList.add("tossing-shadow"); sB.classList.add("tossing-shadow");
        } else if (state === "sheng") {
            bA.classList.add("state-yang"); bB.classList.add("state-yin");
        } else if (state === "xiao") {
            bA.classList.add("state-yang"); bB.classList.add("state-yang");
        } else if (state === "yin") {
            bA.classList.add("state-yin"); bB.classList.add("state-yin");
        } else if (state === "li") {
            bA.classList.add("state-li"); bB.classList.add("state-li");
        }
    }

    async function playGame() {
        if (!contract) return;
        const betInput = document.getElementById("betAmount").value;
        const betValue = parseFloat(betInput);

        if (betValue < 0.001) { alert("æœ€å°ä¸‹æ³¨é‡‘é¡ç‚º 0.001 BNB"); return; }
        if (betValue > currentMaxBet && currentMaxBet > 0.001) { alert(`é‡‘é¡éå¤§ï¼ä¸Šé™ ${currentMaxBet.toFixed(4)}`); return; }

        try {
            document.getElementById("resultDisplay").innerHTML = "ğŸ² æ“²ç­Šä¸­...<br><span style='font-size:16px; color:#FFD700'>è«‹åœ¨éŒ¢åŒ…ç¢ºèª...</span>";
            document.getElementById("playBtn").disabled = true;
            document.getElementById("playBtn").innerText = "â³ äº¤æ˜“ç¢ºèªä¸­...";
            
            setBlocksState("tossing"); // é–‹å§‹æ‹‹æ“²å‹•ç•«

            const tx = await contract.play("0x0000000000000000000000000000000000000000", { 
                value: ethers.utils.parseEther(betInput),
                gasLimit: 500000 
            });
            
            document.getElementById("resultDisplay").innerHTML = "ğŸš€ äº¤æ˜“å·²ç™¼é€ï¼ç­‰å¾…çµæœ...";
            const receipt = await tx.wait();
            const event = receipt.events.find(e => e.event === 'GameResult');
            
            if (event) displayResult(event.args);

        } catch (error) {
            console.error(error);
            alert("äº¤æ˜“å¤±æ•—");
            document.getElementById("resultDisplay").innerText = "âŒ äº¤æ˜“æœªå®Œæˆ";
            setBlocksState("sheng");
        } finally {
            document.getElementById("playBtn").disabled = false;
            document.getElementById("playBtn").innerText = "ğŸ™ èª å¿ƒæ“²ç­Š (Play)";
        }
    }

    function displayResult(args) {
        const { resultType, payout, gameHash } = args;
        document.getElementById("hashDisplay").innerText = gameHash;
        
        const payoutBNB = ethers.utils.formatEther(payout);
        const goldGrams = (parseFloat(payoutBNB) * BNB_PRICE_USD / GOLD_PRICE_USD_PER_GRAM).toFixed(4);
        
        let resultHtml = "";
        if (resultType.includes("Li Jiao")) {
            setBlocksState("li");
            resultHtml = `<div class='critical'>âš¡ ç«‹ç­Šæš´æ“Š (8X) âš¡</div><div class='gold-text'>ç² ${payoutBNB} BNB â‰ˆ ${goldGrams}g é»ƒé‡‘</div>`;
        } else if (resultType.includes("Sheng Jiao")) {
            setBlocksState("sheng");
            resultHtml = `<div class='sheng-jiao'>ğŸ™ è–ç­Š (2X)</div><div class='gold-text'>ç² ${payoutBNB} BNB â‰ˆ ${goldGrams}g é»ƒé‡‘</div>`;
        } else if (resultType.includes("Xiao Jiao")) {
            setBlocksState("xiao");
            resultHtml = `<div class='xiao-jiao'>ğŸ˜Š ç¬‘ç­Š (é€€åŠ)</div><div style='color:#ccc; font-size:14px; margin-top:5px'>é€£å‹ä¸­æ–·</div>`;
        } else {
            setBlocksState("yin");
            resultHtml = `<div class='yin-jiao'>ğŸŒ‘ é™°ç­Š (ç„¡)</div><div style='color:#ccc; font-size:14px; margin-top:5px'>é€£å‹æ­¸é›¶</div>`;
        }
        
        document.getElementById("resultDisplay").innerHTML = resultHtml;
        signer.getAddress().then(addr => updateAllStats(addr));
    }

    // --- Modal æ§åˆ¶ (æ›´æ–°æ•¸æ“šé¡¯ç¤º) ---
    function openLeaderboard() {
        const winnerText = cachedWinner === "å°šç„¡ (è™›ä½ä»¥å¾…)" ? cachedWinner : (cachedWinner.substring(0,8) + "..." + cachedWinner.substring(36));
        document.getElementById("modalWinnerAddr").innerText = winnerText;
        document.getElementById("modalHighestStreak").innerText = cachedHighest.toString();
        document.getElementById("modalMyStreak").innerText = myCurrentStreak.toString(); // é¡¯ç¤ºæˆ‘çš„ç´€éŒ„
        document.getElementById("leaderModal").style.display = "block";
    }
    function openRules() { document.getElementById("rulesModal").style.display = "block"; }
    function closeModal(id) { document.getElementById(id).style.display = "none"; }
    window.onclick = function(e) { if(e.target.className === "modal") e.target.style.display="none"; }
</script>

</body>
</html>



